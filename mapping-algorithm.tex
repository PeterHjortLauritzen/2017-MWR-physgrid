A consequence of separating physics and dynamics grids is that the atmospheric state must be mapped to the physics grid and the physics tendencies must be mapped back to the dynamics grid. This is discussed in separate sections below. When separating physics and dynamics grids it is advantageous to used a vertical coordinate that is static during physics-dynamics coupling. This was one motivation to switch to a dry-mass vertical coordinate in CAM-SE \citep{LetAl2017MWR}; since dry mass remains constant throughout physics the dry-mass vertical coordinate remains fixed during physics-dynamics coupling. We will be using this version of CAM-SE in this paper.
\subsection{Mapping state from dynamics grid (GLL) to physics grid (pg)}
The dynamics state is defined on the GLL grid in terms of temperature $T^{(gll)}$, zonal wind component $u^{(gll)}$, meridional wind component $v^{(gll)}$, and dry pressure level thickness $\Delta p^{(gll)}$. In the mapping of the atmospheric state to the physics grid it is important that the following properties are met:
\begin{enumerate}
\item conservation of scalar quantities such as mass and dry thermal energy,\label{prop1}
\item for tracers; shape-preservation (monotonicity), i.e. the mapping method must not introduce new extrema in the interpolated field, in particular, negatives,\label{prop2}
\item consistency, i.e. the mapping preserves a constant,\label{prop3}
\item linear correlation preservation.
\end{enumerate}
Other properties that may be important, but not pursued here, is total energy conservation and axial angular momentum conservation. We argue that the most consistent method for mapping scalar state variables from the GLL grid to the physics grid is to integrate the Lagrange basis function representation (used by the SE dynamical core) over the physics grid control volumes, i.e. integrate the basis function representation of $\Delta p^{(gll)}\times T^{(gll)}$ and $\Delta p^{(gll)}$ over the physics grid control volume \citep[see, e.g., ][]{LTOUNGK2017MWR,UT2015MWR}
\begin{eqnarray}
\Delta p^{(pg)}&=&\frac{1}{A^{(pg)}}\int_{A^{(pg)}}\Delta p^{(gll)}\, dA,\\
T^{(pg)}&=&\frac{}{A^{(pg)}\Delta p^{(pg)}}\int_{A^{(pg)}}T^{(gll)}\Delta p^{(gll)}\, dA,
\end{eqnarray}
where $A^{(pg)}$ is the physics grid area. The integrals are numerically computed using the GLL quadrature rule. Thermal energy and dry air mass is conserved and the mapping is consistent. For the wind, which is a vector, the latitude-longitude wind components are mapped by transforming to contra-variant wind components, evaluate the basis function representation thereof at the equi-angular center of the physics grid control volumes and then transform back to latitude-longitude coordinate system winds. All of the oprations are local to the element and do not require communication between elements.

The mapping of tracers is more problematic since the SE basis function representation is oscillatory although the shape-preserving filter guarantees shape-preservation at the GLL nodes \citep{GTS2014JCP}. To avoid this issue we use the CAM-SE-CSLAM version of CAM-SE \citep[Conservative Semi-Lagrangian Multi-tracer transport scheme][]{LTOUNGK2017MWR}, where tracers are advected on the $pg=3$ physics grid. Note that in CAM-SE-CSLAM the dry mass internally predicted by CSLAM, $\Delta p^{(cslam)}$, is, by design, equal to $\Delta p^{(gll)}$ integrated over the CSLAM/physics grid control volume \citep{LTOUNGK2017MWR}. Since the tracer grid and physics grids are co-located and $\Delta p^{(pg)}=\Delta p^{(cslam)}$ then the  mass conservation, correlation preservation, consistency and shape-preservation constraints are inherently fulfilled.
%
\subsection{Mapping tendencies from physics grid (pg) to dynamics grid (GLL)}
The physics tendencies are computed on the finite-volume physics grid and are denoted $f_T^{(pg)}$,$f_u^{(pg)}$,$f_v^{(pg)}$, and $f_m^{(pg)}$. Note that dry air mass is not modified by physics and hence there is no tendency for dry mass,  $f_{\Delta p}\equiv 0$. Also, it is important to map tendencies and not state from the physics grid to GLL grid otherwise one will get spurious tendencies from mapping errors when the actual physics tendency is zero (unless a reversible map is used).

It is important that this process:
\begin{enumerate}
\item for tracers; mass tendency is conserved,
\item for tracers; in each tracer grid cell the mass tendency from physics must not exceed tracer mass available in tracer grid cell (it is assumed that the physics tendency will not drive tracer mixing ratio negative on the physics grid),\label{item:phys2fvm_consistency}
\item linear correlation preservation,
\item consistency, i.e. the mapping preserves a constant tendency.
\end{enumerate}
Other properties that may be important, but not pursued here, is total energy conservation (incl. components of total energy) and axial angular momentum conservation. Scalar variables are mapped from physics grid to GLL grid using a tensor-product Lagrange interpolation. The local coordinates on a cubed-sphere are discontinuous at the element edges so the interpolation requires special attention at the cube corners and edges. The details are provided in the Appendix. Lagrange interpolation preserves a constant (including zero) and linear correlations. Tracer and physics grids are co-located so tracer mass, tracer shape, and tracer correlations are trivially preserved on the tracer grid; and the inconsistency in point \ref{item:phys2fvm_consistency} above will not appear. 

We do, however, need to map water tracers (such as water vapor, cloud liquid and cloud ice) to the GLL grid to account for moist effects in the equations of motion solved on the GLL grid. The CSLAM water tracer mixing ratios updated by physics tendencies are mapped to the GLL grid using the same tensor cubic interpolation as is used for temperature and velocity components. In between the calls to physics (i.e. in the dynamical core sub-stepping) the water tracers are advected on the GLL grid with the SE method. Water tracer mass is not conserved in the mapping from tracer/physics grid to GLL grid. This procedure makes sure that the water tracers on the GLL grid are 'nudged' to the CSLAM solution for water tracers and the mass budget is closed on the tracer/physics grid.

In the mapping algorithm from physics to dynamics it was found (a) important to use an algorithm that is smooth across element boundaries and (b) that obtaining mass-conservation without excessive grid imprinting at element edges difficult. In regard to (a), using an algorithm that only uses information from an element of control volumes will (at best) be $C^0$ at the element boundaries where most of the GLL points are located. A stencil that extends beyond one element is necessary. Mass-conservation requires a control volume to be defined around the GLL points \cite[see, .e.g., Figure \ref{fig:cv-grids} in this paper or Figure 8b in ][]{UDJ2016MWR}. These volumes are artificial and not consistent with the SE method. Integrating the CSLAM reconstruction of water tracers of such artificial control volumes led to GLL node grid imprinting in the mapping and will not preserve a constant mixing ratio since the mapping of $\Delta p^{(pg)}$ to GLL will not yield the GLL node value for dry pressure-level thickness (i.e. the maps are not reversible). Hence, after much experimentation, best results in terms of grid-imprinting were obtained with tensor-cubic interpolation and by using the CAM-SE-CSLAM configuration.


